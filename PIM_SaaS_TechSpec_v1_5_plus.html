<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Інтерактивна Документація: PIM SaaS Платформа (v1.8)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 
        Chosen Palette: Calm Harmony (Slate, Zinc, Amber)
        Application Structure Plan: A single-page dashboard with a fixed sidebar for navigation between key sections of the technical document. The structure is thematic, allowing users to explore high-level concepts or dive into technical details like DB architecture and operational patterns. The main content area dynamically displays the selected section. Key interactions include a clickable DB schema that reveals table details in a side panel and an interactive roadmap. This design choice aims to make a dense technical document scannable and digestible.
        Visualization & Content Choices: 
        - DB Schema: Report Info: Complex table structure. -> Goal: Organize & Inform. -> Viz/Method: Interactive diagram using HTML/CSS grid. -> Interaction: Click to open a details panel with columns, keys, and indexes. -> Justification: Provides a layered information experience, from high-level overview to granular detail. -> Library: Tailwind CSS, Vanilla JS.
        - Roadmap: Report Info: Phased plan with DoD. -> Goal: Show Change/Progression. -> Viz/Method: Interactive horizontal timeline. -> Interaction: Click on a phase to view its detailed features and DoD criteria. -> Justification: Clearly structures project milestones. -> Library: Vanilla JS + Tailwind CSS.
        - Workflows: Report Info: Async processes with queues. -> Goal: Organize & Explain. -> Viz/Method: Flowchart diagrams. -> Interaction: Hover effects. -> Justification: Clarifies the sequence of operations, including background jobs. -> Library: Tailwind CSS.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        :root {
            --bg-main: #f8fafc; --text-main: #1e293b; --bg-sidebar: #18181b; --text-sidebar: #f4f4f5;
            --c-primary: #eab308; --c-primary-text: #18181b; --c-primary-light: #fefce8;
            --border-color: #e2e8f0; --card-bg: #ffffff;
        }
        html.dark {
            --bg-main: #09090b; --text-main: #e2e8f0; --bg-sidebar: #09090b; --text-sidebar: #e2e8f0;
            --border-color: #27272a; --card-bg: #18181b;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .nav-link { transition: all 0.2s ease-in-out; }
        .nav-link.active { background-color: var(--c-primary); color: var(--c-primary-text); font-weight: 600; }
        .db-table { cursor: pointer; transition: all 0.3s ease-in-out; border: 1px solid var(--border-color); }
        .db-table:hover, .db-table.selected {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border-color: var(--c-primary);
        }
        .workflow-step:hover { background-color: #f4f4f5; }
        html.dark .workflow-step:hover { background-color: #27272a; }
        .roadmap-phase { cursor: pointer; transition: all 0.2s ease-in-out; }
        .roadmap-phase.active { border-color: var(--c-primary); background-color: var(--c-primary-light); }
        html.dark .roadmap-phase.active { background-color: rgba(234, 179, 8, 0.1); }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #details-panel {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        #details-panel.open {
            transform: translateX(0);
        }
        @media print {
            body { background-color: #fff; color: #000; }
            aside, #details-panel, #theme-toggle { display: none; }
            main { margin-left: 0 !important; padding: 0 !important; }
            .content-section { display: block !important; }
            .bg-white, .bg-slate-50, .bg-sky-50, .bg-amber-100, .bg-rose-50, .bg-emerald-50, .bg-violet-50 { background-color: #fff !important; }
            .shadow-lg, .shadow-sm { box-shadow: none !important; }
            .border { border-width: 1px !important; border-color: #ccc !important; }
            h2 { font-size: 24pt; margin-top: 2rem; }
            h3 { font-size: 18pt; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="relative flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-zinc-800 text-white p-6 fixed h-full shadow-lg flex flex-col">
            <div>
                <h1 class="text-2xl font-bold text-amber-400 mb-2">PIM SaaS Platform</h1>
                <p class="text-xs text-zinc-400 mb-6">Tech Spec v1.8</p>
            </div>
            <nav id="navigation" class="flex-grow">
                <a href="#introduction" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Вступ до Платформи</a>
                <a href="#concept" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Концепція</a>
                <a href="#architecture" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Архітектура БД</a>
                <a href="#rls" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Політики RLS</a>
                <a href="#workflows" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Робочі процеси</a>
                <a href="#operations" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Операції</a>
                <a href="#roadmap" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">План розробки</a>
                <a href="#stack" class="nav-link block py-2 px-4 rounded-lg mb-1 text-sm hover:bg-zinc-700">Тех. стек</a>
            </nav>
            <div class="mt-auto">
                <button id="theme-toggle" class="w-full text-left py-2 px-4 rounded-lg text-sm text-zinc-400 hover:bg-zinc-700 hover:text-white">
                    Змінити тему
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="ml-64 flex-1 p-8 lg:p-12 transition-all duration-300">
            
            <!-- Introduction Section -->
            <section id="introduction" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Вступ до Платформи</h2>
                <p class="text-lg text-slate-600 mb-8">PIM SaaS — це централізована інтелектуальна платформа для керування інформацією про продукти. Вона слугує єдиним джерелом правди для всіх даних про товари, автоматизуючи їх збагачення, структурування та синхронізацію між різними каналами продажів.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="font-bold text-xl mb-4 text-amber-600">Які проблеми вирішує?</h3>
                        <ul class="space-y-3 text-slate-600 dark:text-slate-400">
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Хаос даних:</strong> Усуває розбіжності та помилки в інформації про товари на різних платформах (сайт, маркетплейси, соцмережі).</span></li>
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Ручна робота:</strong> Автоматизує створення SEO-оптимізованих описів, атрибутів та медіа-контенту за допомогою AI.</span></li>
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Складні каталоги:</strong> Дозволяє легко керувати товарами зі складною ієрархією, безліччю варіантів та атрибутів.</span></li>
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Багатомовність:</strong> Спрощує керування контентом для різних ринків та мов з одного місця.</span></li>
                        </ul>
                    </div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="font-bold text-xl mb-4 text-amber-600">Для кого ця платформа?</h3>
                        <ul class="space-y-3 text-slate-600 dark:text-slate-400">
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>E-commerce бізнес:</strong> Інтернет-магазини будь-якого розміру, що прагнуть покращити якість продуктових карток та підвищити конверсію.</span></li>
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Маркетингові команди:</strong> Спеціалісти, яким потрібен ефективний інструмент для створення та поширення контенту.</span></li>
                            <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Продакт-менеджери:</strong> Фахівці, відповідальні за життєвий цикл продукту та точність його опису.</span></li>
                             <li class="flex items-start"><span class="text-amber-500 mr-3 mt-1">✓</span><span><strong>Бренди та виробники:</strong> Компанії зі складними каталогами, що потребують централізованого керування даними.</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Concept Section -->
            <section id="concept" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Загальна Концепція та Архітектура</h2>
                <p class="text-lg text-slate-600 mb-8">Цей розділ окреслює фундаментальні цілі та принципи, на яких будується наша PIM SaaS платформа, забезпечуючи гнучкість, безпеку та орієнтованість на AI.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color"><h3 class="font-bold text-xl mb-2 text-amber-600">Multi-tenancy</h3><p class="text-slate-600 dark:text-slate-400">Повна ізоляція даних кожного клієнта на рівні бази даних за допомогою Row-Level Security (RLS) для гарантії конфіденційності та безпеки.</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color"><h3 class="font-bold text-xl mb-2 text-amber-600">API-First</h3><p class="text-slate-600 dark:text-slate-400">Вся логіка доступна через API, що дозволяє створювати різноманітні клієнтські додатки та інтеграції з іншими системами.</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color"><h3 class="font-bold text-xl mb-2 text-amber-600">AI-Oriented</h3><p class="text-slate-600 dark:text-slate-400">Глибока інтеграція з AI для автоматизації аналізу, структурування, генерації контенту та керування медіафайлами.</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color"><h3 class="font-bold text-xl mb-2 text-amber-600">Гнучка структура</h3><p class="text-slate-600 dark:text-slate-400">Підтримка динамічних ієрархій та атрибутів, що дозволяє клієнтам адаптувати систему під будь-яку бізнес-логіку.</p></div>
                </div>
            </section>

            <!-- Architecture Section -->
            <section id="architecture" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Архітектура Бази Даних</h2>
                <p class="text-lg text-slate-600 mb-8">Інтерактивна схема бази даних. Натисніть на таблицю, щоб побачити її деталі. Схема спроєктована для максимальної гнучкості та продуктивності.</p>
                <div class="bg-card-bg p-8 rounded-xl shadow-lg border border-border-color">
                    <div id="db-schema-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="space-y-4">
                            <h3 class="font-semibold text-lg text-slate-500">Доступ та Організації</h3>
                            <div class="db-table bg-slate-50 dark:bg-zinc-800 p-4 rounded-lg" data-table="organizations">...</div>
                            <div class="db-table bg-slate-50 dark:bg-zinc-800 p-4 rounded-lg" data-table="profiles">...</div>
                            <div class="db-table bg-slate-50 dark:bg-zinc-800 p-4 rounded-lg" data-table="organization_members">...</div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="font-semibold text-lg text-slate-500">Ядро PIM</h3>
                            <div class="db-table bg-sky-50 dark:bg-sky-900/40 p-4 rounded-lg" data-table="group_types">...</div>
                            <div class="db-table bg-sky-50 dark:bg-sky-900/40 p-4 rounded-lg" data-table="groups">...</div>
                            <div class="db-table bg-sky-50 dark:bg-sky-900/40 p-4 rounded-lg" data-table="items">...</div>
                        </div>
                        <div class="space-y-4">
                             <h3 class="font-semibold text-lg text-slate-500">Довідники (BOM)</h3>
                            <div class="db-table bg-emerald-50 dark:bg-emerald-900/40 p-4 rounded-lg" data-table="features">...</div>
                            <div class="db-table bg-emerald-50 dark:bg-emerald-900/40 p-4 rounded-lg" data-table="feature_attributes">...</div>
                            <div class="db-table bg-emerald-50 dark:bg-emerald-900/40 p-4 rounded-lg" data-table="feature_relationships">...</div>
                            <div class="db-table bg-emerald-50 dark:bg-emerald-900/40 p-4 rounded-lg" data-table="item_features">...</div>
                        </div>
                         <div class="space-y-4">
                            <h3 class="font-semibold text-lg text-slate-500">Система та AI</h3>
                            <div class="db-table bg-amber-100 dark:bg-amber-900/40 p-4 rounded-lg" data-table="media_assets">...</div>
                            <div class="db-table bg-rose-50 dark:bg-rose-900/40 p-4 rounded-lg" data-table="content_entries">...</div>
                            <div class="db-table bg-rose-50 dark:bg-rose-900/40 p-4 rounded-lg" data-table="ai_runs">...</div>
                            <div class="db-table bg-violet-50 dark:bg-violet-900/40 p-4 rounded-lg" data-table="jobs">...</div>
                            <div class="db-table bg-violet-50 dark:bg-violet-900/40 p-4 rounded-lg" data-table="audit_logs">...</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- RLS Section -->
            <section id="rls" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Безпека на Рівні Рядків (RLS)</h2>
                <p class="text-lg text-slate-600 mb-8">RLS — це фундаментальний елемент безпеки нашої multi-tenant архітектури. Ось конкретні шаблони політик, що застосовуються до таблиць.</p>
                <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                    <h3 class="font-bold text-xl mb-4 text-amber-600">Шаблон Політики</h3>
                    <div class="bg-zinc-800 text-white rounded-lg p-4 font-mono text-sm overflow-x-auto">
<pre><code>-- 1. Активуємо RLS для таблиці
ALTER TABLE public.items ENABLE ROW LEVEL SECURITY;

-- 2. Дозволяємо доступ до своїх даних
CREATE POLICY "Allow full access to own organization"
ON public.items
FOR ALL
USING (organization_id = (SELECT org_id FROM get_my_org_id()))
WITH CHECK (organization_id = (SELECT org_id FROM get_my_org_id()));

-- Примітка: get_my_org_id() - це допоміжна функція,
-- що повертає ID організації поточного JWT.
</code></pre>
                    </div>
                </div>
            </section>

            <!-- Workflows Section -->
            <section id="workflows" class="content-section">
                 <h2 class="text-4xl font-bold text-zinc-900 mb-4">Ключові Робочі Процеси</h2>
                <p class="text-lg text-slate-600 mb-8">Візуалізація основних процесів, що демонструє, як система обробляє дані від завантаження до генерації контенту.</p>
                 <div class="space-y-10">
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="text-2xl font-bold mb-4 text-zinc-800 dark:text-zinc-200">Фонова обробка зображень (через чергу)</h3>
                        <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
                            <div class="workflow-step text-center p-4 rounded-lg flex-1"><div class="text-4xl mb-2">📥</div><p class="font-semibold">1. Завантаження</p><p class="text-sm text-slate-500">Оригінал зберігається у cold storage.</p></div>
                            <div class="text-2xl text-slate-400">→</div>
                            <div class="workflow-step text-center p-4 rounded-lg flex-1"><div class="text-4xl mb-2">➕</div><p class="font-semibold">2. Створення Завдання</p><p class="text-sm text-slate-500">У таблицю `jobs` додається нове завдання `image_derivative`.</p></div>
                            <div class="text-2xl text-slate-400">→</div>
                            <div class="workflow-step text-center p-4 rounded-lg flex-1"><div class="text-4xl mb-2">⚙️</div><p class="font-semibold">3. Воркер</p><p class="text-sm text-slate-500">Фоновий процес (воркер) бере завдання з черги і виконує його.</p></div>
                            <div class="text-2xl text-slate-400">→</div>
                            <div class="workflow-step text-center p-4 rounded-lg flex-1"><div class="text-4xl mb-2">💾</div><p class="font-semibold">4. Збереження</p><p class="text-sm text-slate-500">Результат (нові версії фото) зберігається у `media_assets`.</p></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Operations Section -->
            <section id="operations" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Операційна Діяльність</h2>
                <p class="text-lg text-slate-600 mb-8">Ключові аспекти для забезпечення продуктивності, надійності та моніторингу системи.</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="font-bold text-xl mb-2 text-amber-600">Індексація</h3>
                        <p class="text-slate-600 dark:text-slate-400">Обов'язкові індекси створюються для всіх `organization_id` та зовнішніх ключів (FK). GIN-індекси використовуються для повнотекстового пошуку, а IVFFlat/HNSW — для векторного пошуку в `pgvector`.</p>
                    </div>
                     <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="font-bold text-xl mb-2 text-amber-600">Черги та Фонові Завдання</h3>
                        <p class="text-slate-600 dark:text-slate-400">Усі довготривалі операції (рендерінг медіа, AI-запити) виконуються асинхронно через таблицю `jobs`. Це запобігає блокуванню інтерфейсу та забезпечує надійність.</p>
                    </div>
                     <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color">
                        <h3 class="font-bold text-xl mb-2 text-amber-600">Бекапи та Відновлення</h3>
                        <p class="text-slate-600 dark:text-slate-400">Supabase забезпечує автоматичні щоденні бекапи бази даних. Для медіафайлів налаштовується версіонування та політики життєвого циклу в S3-сумісному сховищі.</p>
                    </div>
                </div>
            </section>

            <!-- Roadmap Section -->
            <section id="roadmap" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">План розробки</h2>
                <p class="text-lg text-slate-600 mb-8">Інтерактивний план розробки. Натисніть на етап, щоб переглянути його ключові завдання та критерії готовності.</p>
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-4 mb-8">
                    <div id="phase-mvp" class="roadmap-phase flex-1 text-center p-4 border-b-4 border-slate-300">...</div>
                    <div class="text-2xl text-slate-300 hidden md:block">→</div>
                    <div id="phase-prototype" class="roadmap-phase flex-1 text-center p-4 border-b-4 border-slate-300">...</div>
                    <div class="text-2xl text-slate-300 hidden md:block">→</div>
                    <div id="phase-release" class="roadmap-phase flex-1 text-center p-4 border-b-4 border-slate-300">...</div>
                </div>
                <div id="roadmap-details" class="bg-card-bg p-8 rounded-xl shadow-lg border border-border-color min-h-[200px]"></div>
            </section>

            <!-- Stack Section -->
            <section id="stack" class="content-section">
                <h2 class="text-4xl font-bold text-zinc-900 mb-4">Технологічний Стек</h2>
                <p class="text-lg text-slate-600 mb-8">Основні технології та сервіси, що використовуються для побудови платформи.</p>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Supabase</h3><p class="text-sm text-slate-500">Бекенд</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Next.js</h3><p class="text-sm text-slate-500">Фронтенд</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Vercel</h3><p class="text-sm text-slate-500">Хостинг</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">GitHub</h3><p class="text-sm text-slate-500">Контроль версій</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">PostgreSQL</h3><p class="text-sm text-slate-500">База даних</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Tailwind CSS</h3><p class="text-sm text-slate-500">Стилізація</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Appsmith/Retool</h3><p class="text-sm text-slate-500">Внутрішня адмінка</p></div>
                    <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color text-center"><h3 class="font-bold text-lg">Docker</h3><p class="text-sm text-slate-500">Селф-хостинг</p></div>
                </div>
            </section>

        </main>
        
        <!-- Details Panel -->
        <div id="details-panel" class="fixed top-0 right-0 h-full w-full md:w-1/3 lg:w-1/4 bg-white dark:bg-zinc-900 shadow-2xl p-6 overflow-y-auto border-l border-border-color">
            <div class="flex justify-between items-center mb-6">
                <h3 id="details-title" class="text-2xl font-bold">Деталі</h3>
                <button id="close-details" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-zinc-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="details-content">
                <p class="text-slate-500">Натисніть на таблицю, щоб побачити деталі.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dbData = {
                organizations: { name: "organizations", desc: "Інформація про клієнтів", color: "bg-slate-50 dark:bg-zinc-800", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "name", type: "text" }, { name: "created_at", type: "timestamptz" }, { name: "updated_at", type: "timestamptz" } ] },
                profiles: { name: "profiles", desc: "Дані користувачів", color: "bg-slate-50 dark:bg-zinc-800", columns: [ { name: "id", type: "uuid", key: "PK, FK (auth.users)" }, { name: "full_name", type: "text" } ] },
                organization_members: { name: "organization_members", desc: "Зв'язок користувач-організація", color: "bg-slate-50 dark:bg-zinc-800", columns: [ { name: "organization_id", type: "uuid", key: "FK (organizations)" }, { name: "user_id", type: "uuid", key: "FK (profiles)" }, { name: "role", type: "text" } ] },
                group_types: { name: "group_types", desc: "Типи рівнів ієрархії", color: "bg-sky-50 dark:bg-sky-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "organization_id", type: "uuid", key: "FK" }, { name: "name", type: "text" }, { name: "level", type: "integer" } ] },
                groups: { name: "groups", desc: "Ієрархія каталогу (дерево)", color: "bg-sky-50 dark:bg-sky-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "parent_id", type: "uuid", key: "FK (self)" }, { name: "group_type_id", type: "uuid", key: "FK" }, { name: "name", type: "text" } ] },
                items: { name: "items", desc: "Фінальні товари (SKU)", color: "bg-sky-50 dark:bg-sky-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "parent_group_id", type: "uuid", key: "FK" }, { name: "sku", type: "text", key: "UNIQUE" }, { name: "attributes", type: "jsonb" }, { name: "embedding", type: "vector" } ] },
                features: { name: "features", desc: "Довідник характеристик", color: "bg-emerald-50 dark:bg-emerald-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "name", type: "text" }, { name: "feature_type", type: "text" } ] },
                feature_attributes: { name: "feature_attributes", desc: "Конфігурація атрибутів", color: "bg-emerald-50 dark:bg-emerald-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "code", type: "text", key: "UNIQUE" }, { name: "label", type: "text" }, { name: "root_feature_id", type: "uuid", key: "FK" } ] },
                feature_relationships: { name: "feature_relationships", desc: "Зв'язки характеристик (BOM)", color: "bg-emerald-50 dark:bg-emerald-900/40", columns: [ { name: "parent_feature_id", type: "uuid", key: "FK" }, { name: "child_feature_id", type: "uuid", key: "FK" }, { name: "edge_type", type: "text" } ] },
                item_features: { name: "item_features", desc: "Призначення характеристик", color: "bg-emerald-50 dark:bg-emerald-900/40", columns: [ { name: "item_id", type: "uuid", key: "FK" }, { name: "feature_attribute_id", type: "uuid", key: "FK" }, { name: "feature_term_id", type: "uuid", key: "FK" } ] },
                media_assets: { name: "media_assets", desc: "Метадані медіафайлів", color: "bg-amber-100 dark:bg-amber-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "item_id", type: "uuid", key: "FK" }, { name: "storage_path", type: "text" }, { name: "checksum_sha256", type: "text", key: "UNIQUE" } ] },
                content_entries: { name: "content_entries", desc: "Багатомовний контент", color: "bg-rose-50 dark:bg-rose-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "parent_id", type: "uuid", key: "FK" }, { name: "language_code", type: "text" }, { name: "status", type: "text" }, { name: "version", type: "integer" } ] },
                ai_runs: { name: "ai_runs", desc: "Журнал запусків AI", color: "bg-rose-50 dark:bg-rose-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "entry_id", type: "uuid", key: "FK" }, { name: "cost", type: "numeric" }, { name: "status", type: "text" } ] },
                jobs: { name: "jobs", desc: "Черга фонових завдань", color: "bg-violet-50 dark:bg-violet-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "kind", type: "text" }, { name: "payload", type: "jsonb" }, { name: "status", type: "text" } ] },
                audit_logs: { name: "audit_logs", desc: "Журнал дій", color: "bg-violet-50 dark:bg-violet-900/40", columns: [ { name: "id", type: "uuid", key: "PK" }, { name: "user_id", type: "uuid", key: "FK" }, { name: "action", type: "text" }, { name: "payload", type: "jsonb" } ] },
            };
            const roadmapData = {
                mvp: { title: "Етап 1: MVP", description: "Створення ядра системи...", features: ["RLS-політики на всіх таблицях", "Експорт/імпорт CSV із валідацією", "p95 API < 200 мс для ≥1k SKU"] },
                prototype: { title: "Етап 2: Робочий Прототип", description: "Додавання інтелектуальних функцій...", features: ["Пайплайн медіа з чергою та дедуплікацією", "pgvector + top-k семантичний пошук", "Workflow «AI draft → approve → publish»", "Аудит на CUD операції"] },
                release: { title: "Етап 3: Публічний Реліз", description: "Підготовка до комерційного запуску...", features: ["Білінг (Stripe) з тарифами/квотами", "Розширені ролі/права доступу", "Моніторинг та система тривог"] }
            };

            const mainContent = document.getElementById('main-content');
            const detailsPanel = document.getElementById('details-panel');
            const detailsTitle = document.getElementById('details-title');
            const detailsContent = document.getElementById('details-content');
            const closeDetailsBtn = document.getElementById('close-details');
            const themeToggleBtn = document.getElementById('theme-toggle');

            function populateDbGrid() {
                const grid = document.getElementById('db-schema-grid');
                grid.querySelectorAll('.db-table').forEach(el => {
                    const tableKey = el.dataset.table;
                    const tableData = dbData[tableKey];
                    if (tableData) {
                        el.innerHTML = `<h4 class="font-bold">${tableData.name}</h4><p class="text-sm text-slate-500">${tableData.desc}</p>`;
                    }
                });
            }
            
            function populateRoadmapPhases() {
                document.querySelector('#phase-mvp').innerHTML = `<p class="text-sm text-slate-500">Етап 1</p><p class="text-xl font-semibold">MVP</p>`;
                document.querySelector('#phase-prototype').innerHTML = `<p class="text-sm text-slate-500">Етап 2</p><p class="text-xl font-semibold">Робочий Прототип</p>`;
                document.querySelector('#phase-release').innerHTML = `<p class="text-sm text-slate-500">Етап 3</p><p class="text-xl font-semibold">Публічний Реліз</p>`;
            }

            function showSection(hash) {
                const targetHash = hash || '#introduction';
                document.querySelectorAll('.content-section').forEach(s => s.classList.toggle('active', '#' + s.id === targetHash));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.toggle('active', l.getAttribute('href') === targetHash));
                if (detailsPanel.classList.contains('open')) closeDetailsPanel();
            }

            function showRoadmapDetails(phaseId) {
                const phaseData = roadmapData[phaseId];
                if (!phaseData) return;
                const featuresHtml = phaseData.features.map(f => `<li class="flex items-start"><span class="text-amber-500 mr-2 mt-1">✓</span><span>${f}</span></li>`).join('');
                document.getElementById('roadmap-details').innerHTML = `<div class="fade-in"><h3 class="text-2xl font-bold text-zinc-800 dark:text-zinc-200 mb-2">${phaseData.title}</h3><p class="text-slate-600 dark:text-slate-400 mb-4">${phaseData.description}</p><ul class="space-y-2 text-slate-700 dark:text-slate-300">${featuresHtml}</ul></div>`;
                document.querySelectorAll('.roadmap-phase').forEach(p => p.classList.toggle('active', p.id === `phase-${phaseId}`));
            }

            function showTableDetails(tableKey) {
                const tableData = dbData[tableKey];
                if (!tableData) return;
                detailsTitle.textContent = tableData.name;
                const columnsHtml = tableData.columns.map(c => `
                    <div class="flex justify-between items-center py-2 border-b border-border-color">
                        <div>
                            <span class="font-semibold">${c.name}</span>
                            <span class="text-xs text-slate-400 ml-2">${c.type}</span>
                        </div>
                        ${c.key ? `<span class="text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300 px-2 py-1 rounded-full">${c.key}</span>` : ''}
                    </div>`).join('');
                detailsContent.innerHTML = `<div class="space-y-2">${columnsHtml}</div>`;
                detailsPanel.classList.add('open');
                mainContent.classList.add('md:pr-[33.33%]', 'lg:pr-[25%]');
                document.querySelectorAll('.db-table').forEach(t => t.classList.toggle('selected', t.dataset.table === tableKey));
            }

            function closeDetailsPanel() {
                detailsPanel.classList.remove('open');
                mainContent.classList.remove('md:pr-[33.33%]', 'lg:pr-[25%]');
                document.querySelectorAll('.db-table.selected').forEach(t => t.classList.remove('selected'));
            }
            
            function toggleTheme() {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            }

            document.getElementById('navigation').addEventListener('click', e => {
                if (e.target.matches('.nav-link')) { e.preventDefault(); window.location.hash = e.target.getAttribute('href'); }
            });
            window.addEventListener('hashchange', () => showSection(window.location.hash));
            document.querySelectorAll('.roadmap-phase').forEach(p => p.addEventListener('click', () => showRoadmapDetails(p.id.split('-')[1])));
            document.getElementById('db-schema-grid').addEventListener('click', e => {
                const tableEl = e.target.closest('.db-table');
                if (tableEl) showTableDetails(tableEl.dataset.table);
            });
            closeDetailsBtn.addEventListener('click', closeDetailsPanel);
            themeToggleBtn.addEventListener('click', toggleTheme);

            // Initial load
            populateDbGrid();
            populateRoadmapPhases();
            if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');
            showSection(window.location.hash);
            showRoadmapDetails('mvp');
        });
    </script>
</body>
</html>
